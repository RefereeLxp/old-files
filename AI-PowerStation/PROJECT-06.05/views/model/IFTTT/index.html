<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>AdminLTE 2 | Dashboard</title>
    <!-- Tell the browser to be responsive to screen width -->
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <!-- Bootstrap 3.3.6 -->
    <link rel="stylesheet" href="../../../css/bootstrap.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="../../../css/font-awesome.css">
    <!-- Theme style -->
    <link rel="stylesheet" href="../../../css/AdminLTE.css">
    <!-- AdminLTE Skins. Choose a skin from the css/skins
         folder instead of downloading all of them to reduce the load. -->
    <link rel="stylesheet" href="../../../css/skins/_all-skins.min.css">
    <!-- iCheck -->
    <link rel="stylesheet" href="../../../js/plugins/iCheck/flat/blue.css">
    <!-- jvectormap -->
    <link rel="stylesheet" href="../../../js/plugins/jvectormap/jquery-jvectormap-1.2.2.css">
    <!-- Date Picker -->
    <link rel="stylesheet" href="../../../js/plugins/datepicker/datepicker3.css">
    <!-- Daterange picker -->
    <link rel="stylesheet" href="../../../js/plugins/daterangepicker/daterangepicker.css">
    <!-- bootstrap wysihtml5 - text editor -->
    <link rel="stylesheet" href="../../../js/plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.min.css">
    <link rel="stylesheet" href="../../../js/plugins/datatables/dataTables.bootstrap.css">
    <link rel="stylesheet" href="../../../css/new.css"/>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<body class="hold-transition skin-blue sidebar-mini">
<div class="wrapper">

    <header class="main-header">
        <a href="../../home/main/index.html" class="logo" style="padding-left: 0;padding-right: 0;">
          <span class="logo-mini">
          <img src="../../../image/logo.jpg" alt=""/>
          </span>
          <span class="logo-lg" style="text-align: left;background: #333333;padding-left: 10px;">
            <img src="../../../image/logo.jpg" alt=""/>
            <b style="font-size: 16px;">管理控制台</b>
          </span>
        </a>
        <nav class="navbar navbar-static-top" style="background: #333333;box-shadow:0px 5px 0 #FEC97D">
            <!-- Sidebar toggle button-->
            <a href="#" class="sidebar-toggle" data-toggle="offcanvas" role="button">
                <span class="sr-only">Toggle navigation</span>
            </a>
            <div class="navbar-custom-menu">
                <ul class="nav navbar-nav choose">
                    <li class="dropdown user user-menu" id="userName">
                        <!--<a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-expanded="false">-->
                            <!--<img src="../../../image/111.jpg" class="user-image" alt="User Image">-->
                            <!--<span class="hidden-xs">${name}</span>-->
                        <!--</a>-->
                        <!--<ul class="dropdown-menu">-->
                            <!--<li class="user-header">-->
                                <!--<img src="../../../image/111.jpg" class="img-circle" alt="User Image">-->

                                <!--<p>-->
                                    <!--tom-超级管理员-->
                                    <!--<small>成员 since Nov. 2012</small>-->
                                <!--</p>-->
                            <!--</li>-->
                            <!--<li class="user-footer">-->
                                <!--<div class="pull-left">-->
                                    <!--<a href="#" class="btn btn-default btn-flat">Profile</a>-->
                                <!--</div>-->
                                <!--<div class="pull-right">-->
                                    <!--<a href="#" class="btn btn-default btn-flat"onclick="logout()">登出</a>-->
                                <!--</div>-->
                            <!--</li>-->
                        <!--</ul>-->
                    </li>
                </ul>
            </div>
        </nav>
    </header>
    <aside class="main-sidebar">
        <section class="sidebar" id="sidebar">
            <div style="height: 60px;"></div>
            <ul class="sidebar-menu">
                <!--<li class="treeview ztjc">-->
                    <!--<a href="#">-->
                        <!--<i class="fa"></i> <span>状态监测</span>-->
                    <!--</a>-->
                    <!--<ul class="treeview-menu">-->
                        <!--<li><a href="../../home/main/index.html"><i class="fa fa-circle"></i> 实时数据 <i class="fa  fa-caret-right"></i></a></li>-->
                    <!--</ul>-->
                <!--</li>-->
                <!--<li class="treeview rysz">-->
                    <!--<a href="#">-->
                        <!--<i class="fa "></i>-->
                        <!--<span>人员设置</span>-->
                    <!--</a>-->
                    <!--<ul class="treeview-menu">-->
                        <!--<li><a href="../../prv/role/index.html"><i class="fa fa-circle"></i> 角色设置 <i class="fa  fa-caret-right"></i></a></li>-->
                        <!--<li><a href="../../prv/member/index.html"><i class="fa fa-circle"></i> 操作员设置 <i class="fa  fa-caret-right"></i></a></li>-->
                        <!--<li><a href="../../prv/manage/index.html"><i class="fa fa-circle"></i> 日志查询 <i class="fa  fa-caret-right"></i></a></li>-->
                    <!--</ul>-->
                <!--</li><li class="treeview zdsz">-->
                <!--<a href="#">-->
                    <!--<i class="fa "></i>-->
                    <!--<span>站点设置</span>-->
                <!--</a>-->
                <!--<ul class="treeview-menu">-->
                    <!--<li><a href="../../ass/psysical/index.html"><i class="fa fa-circle"></i> 物理设置 <i class="fa  fa-caret-right"></i></a></li>-->
                    <!--<li><a href="../../ass/gateway/index.html"><i class="fa fa-circle"></i> 网关设置 <i class="fa  fa-caret-right"></i></a></li>-->
                    <!--<li><a href="../../ass/alarm/index.html"><i class="fa fa-circle"></i> 监控告警 <i class="fa  fa-caret-right"></i></a></li>-->
                    <!--<li><a href="../../ass/history/index.html"><i class="fa fa-circle"></i> 数据采集 <i class="fa  fa-caret-right"></i></a></li>-->
                <!--</ul>-->
            <!--</li>-->
                <!--<li class="active treeview qjsz">-->
                    <!--<a href="#">-->
                        <!--<i class="fa "></i>-->
                        <!--<span>情景设置</span>-->
                    <!--</a>-->
                    <!--<ul class="treeview-menu">-->
                        <!--<li class="active"><a href="index.html"><i class="fa fa-circle"></i> 情景模式 <i class="fa  fa-caret-right"></i></a></li>-->
                    <!--</ul>-->
                <!--</li>-->
                <!--<li class="treeview jcsz">-->
                    <!--<a href="#">-->
                        <!--<i class="fa "></i>-->
                        <!--<span>基础设置</span>-->
                    <!--</a>-->
                    <!--<ul class="treeview-menu">-->
                    <!--</ul>-->
                <!--</li>-->
                <!--<li class="treeview gywm">-->
                    <!--<a href="#">-->
                        <!--<i class="fa "></i>-->
                        <!--<span>关于我们</span>-->
                    <!--</a>-->
                    <!--<ul class="treeview-menu">-->
                        <!--<li><a href="../../about/index.html"><i class="fa fa-circle"></i> 简介 <i class="fa  fa-caret-right"></i></a></li>-->
                    <!--</ul>-->
                <!--</li>-->

            </ul>
        </section>
        <!-- /.sidebar -->
    </aside>
    <div class="content-wrapper">
        <div class="row">
            <div class="col-xs-12">
                <!-- Main content -->
                <section class="content">
                    <div class="box">
                        <div class="box-header with-border">
                            <h3 class="box-title">监控主机表</h3>
                            <div class="operate-tip">
                                <i class="glyphicon glyphicon-pushpin"></i>
                                <b></b>
                            </div>
                        </div>
                        <!-- /.box-header -->
                        <div class="box-body">
                            <table id="example1" class="table table-bordered table-hover">
                                <thead>
                                <tr>
                                    <th>监控主机id</th>
                                    <th>监控主机编号</th>
                                    <th>监控主机名称</th>
                                    <th>监控主机key</th>
                                    <th>所属监控站</th>
                                    <th>IP地址</th>
                                    <th>操作</th>
                                </tr>
                                </thead>
                                <tbody>

                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="operate-group">
                        <div class="pull-right box-tools">
                            <button class="btn"id="add0">添加</button>
                            <button class="btn"id="save0">保存</button>
                            <button class="btn"id="save1">保存修改</button>
                        </div>
                    </div>
                    <div class="table-group">
                        <div class="box">
                            <div class="box-header with-border">
                                <h3 class="box-title">IFTTT表</h3>
                                <div class="operate-tip">
                                    <i class="glyphicon glyphicon-pushpin"></i>
                                    <b></b>
                                </div>
                            </div>
                            <div class="box-body">
                                <table id="example2" class="table table-bordered table-hover">
                                    <thead>
                                    <tr>
                                        <th>序号</th>
                                        <th>房间</th>
                                        <th>IFTTT名称</th>
                                        <th>是否开启</th>
                                        <th>通知是否开启</th>
                                        <th>操作</th>
                                    </tr>
                                    </thead>
                                    <tbody>

                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="box">
                            <div class="box-header with-border">
                                <h3 class="box-title">IFTTT设置-触发条件</h3>
                                <div class="operate-tip">
                                    <i class="glyphicon glyphicon-pushpin"></i>
                                    <b></b>
                                </div>
                                <div class="pull-right box-tools">
                                    <button class="btn"id="addL1">添加一行</button>
                                </div>
                            </div>
                            <div class="box-body">
                                <table id="example3" class="table table-bordered table-hover">
                                    <thead>
                                    <tr>
                                        <th>房间ID</th>
                                        <th>设备类型</th>
                                        <th>设备名</th>
                                        <th>应用状态</th>
                                        <th>数值</th>
                                        <th>操作</th>
                                    </tr>
                                    </thead>
                                    <tbody>

                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="box">
                            <div class="box-header with-border">
                                <h3 class="box-title">IFTTT设置-设备</h3>
                                <div class="operate-tip">
                                    <i class="glyphicon glyphicon-pushpin"></i>
                                    <b></b>
                                </div>
                                <div class="pull-right box-tools">
                                    <button class="btn"id="addL2">添加一行</button>
                                </div>
                            </div>
                            <div class="box-body">
                                <table id="example4" class="table table-bordered table-hover">
                                    <thead>
                                    <tr>
                                        <th style="width: 10%">房间ID</th>
                                        <th style="width: 18%">设备类型</th>
                                        <th style="width: 18%">设备名称</th>
                                        <th style="width: 18%">状态(开/关)</th>
                                        <th style="width: 18%">延时值</th>
                                    </tr>
                                    </thead>
                                    <tbody>

                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </div>

        <div class="modal fade" id="maintenance" tabindex="-1" role="dialog" aria-labelledby="ModalLabel1" aria-hidden="true" data-backdrop="static">
            <div class="modal-dialog" style="width:560px;margin-top: 220px">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                            ×
                        </button>
                        <h4 class="modal-title" >
                            情景设置
                        </h4>
                    </div>
                    <div class="modal-body" id="flex">
                    </div>
                </div>
                <!-- /.modal-content -->
            </div>
            <!-- /.modal -->
        </div>
    </div>
</div>
<!-- jQuery 2.2.3 -->
<script src="../../../js/plugins/jQuery/jquery-2.2.3.min.js"></script>
<!-- jQuery UI 1.11.4 -->
<script src="../../../js/plugins/jQueryUI/jquery-ui.min.js"></script>
<!-- Resolve conflict in jQuery UI tooltip with Bootstrap tooltip -->
<script>
    $.widget.bridge('uibutton', $.ui.button);
</script>
<!-- Bootstrap 3.3.6 -->
<script src="../../../js/bootstrap.min.js"></script>
<script src="../../../js/plugins/datatables/jquery.dataTables.min.js"></script>
<script src="../../../js/plugins/datatables/dataTables.bootstrap.min.js"></script>
<script src="../../../js/menu.js"></script>
<script src="../../../js/normal.js"></script>
<!-- Sparkline -->
<script src="../../../js/plugins/sparkline/jquery.sparkline.min.js"></script>
<!-- jvectormap -->
<script src="../../../js/plugins/jvectormap/jquery-jvectormap-1.2.2.min.js"></script>
<script src="../../../js/plugins/jvectormap/jquery-jvectormap-world-mill-en.js"></script>
<script src="../../../js/plugins/chartjs/Chart.js"></script>
<!-- jQuery Knob Chart -->
<script src="../../../js/plugins/knob/jquery.knob.js"></script>
<!-- daterangepicker -->
<script src="../../../js/moment.js"></script>
<script src="../../../js/plugins/daterangepicker/daterangepicker.js"></script>
<!-- datepicker -->
<script src="../../../js/plugins/datepicker/bootstrap-datepicker.js"></script>
<!-- Bootstrap WYSIHTML5 -->
<script src="../../../js/plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.all.min.js"></script>
<!-- Slimscroll -->
<script src="../../../js/plugins/slimScroll/jquery.slimscroll.min.js"></script>
<!-- FastClick -->
<script src="../../../js/plugins/fastclick/fastclick.js"></script>
<!-- AdminLTE App -->
<script src="../../../js/app.min.js"></script>
<!-- AdminLTE dashboard demo (This is only for demo purposes) -->
<script src="../../../js/pages/dashboard.js"></script>
<!-- AdminLTE for demo purposes -->
<script src="../../../js/demo.js"></script>
<script src="../../../js/sdk/SH_SDK_v1.1.2.js"></script>
<script type="text/javascript" src="../../../js/sdk/gateway.js"></script>
<script type="text/javascript" src="../../../js/sdk/displayInformation.js"></script>
<script type="text/javascript" src="../../../js/sdk/config.js"></script>
<script type="text/javascript" src="../../../js/sdk/operate.js"></script>
<script type="text/javascript" src="../../../js/sdk/scene.js"></script>
<script type="text/javascript" src="../../../js/sdk/IFTTT.js"></script>
<script>

    //----------------------------------------------------------------------------------------------------------------------
    var kHost = null;
    var tempHost = null;
    var str=null;
    var refresh=null;
    var tempnn=0;
    var roomI='';
    $('#example1').on('click','.stations-check',function(){
        var host_code=$(this).parent().parent().find('td').eq(1).html();
        var host_key=$(this).parent().parent().find('td').eq(3).html();
        console.log(host_code,host_key);
        sessionStorage.setItem('host_code',host_code);
        sessionStorage.setItem('host_key',host_key);
        location.reload();
    });
    function connect() {
        var deviceId = sessionStorage['host_code'];
        var accessKey = sessionStorage['host_key'];

        kHost = new CKHost(deviceId, accessKey);
        kHost.registerHostStatusCallback(hostStatusCallBack);
        kHost.registerDeviceStatusCallback(deviceStatusCallBack);
        kHost.init();
        tempHost=kHost.mainHost;
    }
    if(sessionStorage['host_code']!=null) {
        connect();
    }
    function hostStatusCallBack(data) {
        //console.debug('hostStatusCallBack: [' + data + ']');
        $("#link").html(kHost.linkStatus ? '成功' : '');
        $("#login").html(kHost.loginStatus ? '成功' : '');
        $("#synch").html(kHost.synStatus ? '成功' : '');
        str=showEXIFTTT();
        if(kHost.synStatus) {
            roomI=tempHost.hostDataRepository.getAllRoomsInfo()[0].id;
        }
        if(str!=''&&str!=undefined){
            var html='';
            for(var i=0;i<str.length;i++){
                console.error(str[i]);
                html+=`
                <tr>
                    <td>${str[i].id}</td>
                    <td>${str[i].roomId}</td>
                    <td>${str[i].name}</td>
                    <td>${str[i].ruleEnable}</td>
                    <td>${str[i].notificationEnable}</td>
                    <td>
                        <a href="#" onclick="showT(${i})">查看</a>
                        <span>|</span>
                        <a href="#"onclick=deleteT("${str[i].id}")>删除</a>
                        <span>|</span>
                        <a href="#"onclick=revT("${str[i].id}")>编辑</a>
                    </td>
                </tr>
                `;
                $.ajax({
                    url: url_top+'monitor/scene/ifttt/create',
                    type: 'POST',
                    data: {id:str[i].id,name:str[i].name,ruleEnable:str[i].ruleEnable,notificationEnable:str[i].notificationEnable,roomId:str[i].roomId,type:str[i].type,actionList:JSON.stringify(str[i].actionList),limitConditionList:JSON.stringify(str[i].limitConditionList)}
                })
            }
            $('#example2 tbody').empty().html(html);
            refresh=$("#example2").DataTable();
        }
        if($('#example2 tbody').find('tr').length>0){
            $('body').find("[data-step]").show();
        };
    }
    function deviceStatusCallBack(jData) {
        console.debug('deviceStatusCallBack: id[' + jData.id + '] name[' + jData.name + ']');
        console.debug(jData);
        str=showEXIFTTT();
    }

    function getFloor() {
        var jdata = kHost.getFloor();
        console.debug('getFloor num[' + jdata.length + ']');
        for(var i in jdata){
            console.debug('getFloor [' + i + '] id[' + jdata[i].id + '] name[' + jdata[i].name + ']');
        }
        console.debug(jdata);
        postFloor(jdata);
    }

    function getRoom() {
        var jdata = kHost.getRoom();
        console.debug('getRoom num[' + jdata.length + ']');
        for(var i in jdata){
            console.debug('getRoom [' + i + '] id[' + jdata[i].id + '] name[' + jdata[i].name + '] floorid[' + jdata[i].floorId + ']');
        }
        postRoom(jdata);
    }

    function checkHostObject() {
        if (tempHost== null) {
            return false;
        }
        return true;
    }
    //查看相应主机下的设备
    function showT(n){
        str=showEXIFTTT();
        tempnn=n;
        console.error(str[n]);
        var html='';
        for(var i=0;i<str[n].conditionList.length;i++) {
            var deviceT='';
            switch (str[n].conditionList[i].deviceType) {
                case 'ZIGBEE_Light':
                    deviceT='灯';
                    break;
                case 'ZIGBEE_KonkeSocket':
                    deviceT='智能插座';
                    break;
                case 'ZIGBEE_InfraredSensor':
                    deviceT='人体红外';
                    break;
                case 'ZIGBEE_SmokeSensor':
                    deviceT='烟感';
                    break;
                case 'ZIGBEE_DipSensor':
                    deviceT='水浸传感';
                    break;
                case 'ZIGBEE_DoorSensor':
                    deviceT='门磁';
                    break;
                case 'ZIGBEE_TempSensor':
                    deviceT='温度传感器';
                    break;
                case 'ZIGBEE_HumiSensor':
                    deviceT='湿度传感器';
                    break;
            }
                html += `
                <tr>
                    <td>${str[n].conditionList[i].roomId}</td>
                    <td>${deviceT}</td>
                    <td>${str[n].conditionList[i].name}</td>
                    <td>${str[n].conditionList[i].compareType}</td>
                    <td>${str[n].conditionList[i].rightValue}</td>
                    <td></td>
                </tr>
                `
        }
        $('#example3 tbody').empty().html(html);
        var html2=''
        for(var i=0;i<str[n].actionList.length;i++){
            var deviceT2='';
            switch (str[n].actionList[i].deviceType) {
                case 'ZIGBEE_Light':
                    deviceT2='灯';
                    break;
                case 'ZIGBEE_KonkeSocket':
                    deviceT2='智能插座';
                    break;
                case 'ZIGBEE_InfraredSensor':
                    deviceT2='人体红外';
                    break;
                case 'ZIGBEE_SmokeSensor':
                    deviceT2='烟感';
                    break;
                case 'ZIGBEE_DipSensor':
                    deviceT2='水浸传感';
                    break;
                case 'ZIGBEE_DoorSensor':
                    deviceT2='门磁';
                    break;
                case 'ZIGBEE_TempSensor':
                    deviceT2='温度传感器';
                    break;
                case 'ZIGBEE_HumiSensor':
                    deviceT2='湿度传感器';
                    break;
            }
            html2+=`
                <tr>
                    <td>${str[n].actionList[i].roomId}</td>
                    <td>${deviceT2}</td>
                    <td>${str[n].actionList[i].name}</td>
                    <td>${str[n].actionList[i].operation}</td>
                    <td>${str[n].actionList[i].delay}</td>
                </tr>
            `
        }
        $('#example4 tbody').empty().html(html2);
    }
    function deleteT(n){
        tempHost.asyncDeleteIFTTT(n);
        refresh.destroy();
        setTimeout(function(){connect()},1000)
    }
    var tempD=''
    $('#add0').click(function(){
        $('#example3').unbind();
        tempD=showAllDevices();
        var html1=`
                <tr>
                    <td></td>
                      <td><input type="text" id="IFTTTRoom" value="${roomI}"disabled></td>
                      <td><input type="text" id="IFTTTName"></td>
                      <td>
                        <select id="IFTTTNoteEnable">
                          <option value="true">启用</option>
                          <option value="false">禁用</option>
                        </select>
                      </td>
                      <td>
                        <select id="IFTTTEnable">
                          <option value="true">启用</option>
                          <option value="false">禁用</option>
                        </select>
                      </td>
                    <td>

                    </td>
                </tr>`;

        $('#example2 tbody').empty().html(html1);
        var html2=`
        <tr>
            <td><input type="text"id="roomIdI0"value='${roomI}'disabled/></td>
            <td><select name="deviceType"id="deviceTypeI0">
                <option value="0">请选择</option>
                <option value="ZIGBEE_Light">灯</option>
                <option value="ZIGBEE_InfraredTransponder">红外遥控</option>
                <option value="ZIGBEE_CurtainMotor">窗帘电机</option>
                <option value="ZIGBEE_KonkeSocket">智能插座</option>
                <option value="ZIGBEE_InfraredSensor">人体红外</option>
                <option value="ZIGBEE_SmokeSensor">烟感</option>
                <option value="ZIGBEE_DipSensor">水浸</option>
                <option value="ZIGBEE_DoorSensor">门禁</option>
                <option value="ZIGBEE_TempSensor">温度传感</option>
                <option value="ZIGBEE_HumiSensor">湿度传感</option>
            </select></td>
            <td><select name="id"id="selI0">
                    </select></td>
            <td><select name="compareType"id="compareTypeI0">
                <option value="0">请选择</option>
                <option value="1">相等</option>
                <option value="2">小于</option>
                <option value="3">大于</option>
            </select></td>
            <td><input type="text"id="xiaoyu0"/></td>
            <td></td>
        </tr>` ;
        $('#example3').on('change','#deviceTypeI0',function() {
                    var html3='';
                    for (var i = 0; i < tempD.length; i++) {
                        (function (i) {
                            if (tempD[i].deviceType == $('#deviceTypeI0').val()) {
                                html3 += `
                                <option value="${tempD[i].id}">${tempD[i].name}</option>
                                `
                            }
                        })(i)
                    }
                    $('#selI0').html(html3);
                    var htmle1='';
                    var htmle2='';
                    switch ($(this).val()) {
                        case 'ZIGBEE_Light':
                            htmle1+=`
                                <option value="ON">开</option>
                                <option value="OFF">关</option>
                            `
                            htmle2=true;
                            break;
                        case 'ZIGBEE_KonkeSocket':
                            htmle1+=`
                                <option value="ON">开</option>
                                <option value="OFF">关</option>
                            `
                            htmle2=true;
                            break;
                        case 'ZIGBEE_InfraredSensor':
                            htmle1+=`
                                <option value="1">报警</option>
                            `
                            htmle2=true;
                            break;
                        case 'ZIGBEE_SmokeSensor':
                            htmle1+=`
                                <option value="1">报警</option>
                            `
                            htmle2=true;
                            break;
                        case 'ZIGBEE_DipSensor':
                            htmle1+=`
                                <option value="1">报警</option>
                            `
                            htmle2=true;
                            break;
                        case 'ZIGBEE_DoorSensor':
                            htmle1+=`
                                <option value="OPEN">开</option>
                                <option value="CLOSE">关</option>
                            `
                            htmle2=true;
                            break;
                        case 'ZIGBEE_TempSensor':
                            htmle1+=`
                                <option value="1">相等</option>
                                <option value="2">小于</option>
                                <option value="3">大于</option>
                            `
                            break;
                        case 'ZIGBEE_HumiSensor':
                            htmle1+=`
                                <option value="1">相等</option>
                                <option value="2">小于</option>
                                <option value="3">大于</option>
                            `
                            break;
                    }
                    if(htmle1!=''){
                        $('#compareTypeI0').html(htmle1);
                    }
                    if(htmle2==true){
                        $('#xiaoyu0').attr('type','hidden');
                    }else{
                        $('#xiaoyu0').attr('type','text');
                    }
                }
        )
        $('#example3 tbody').empty().html(html2);
        var html4=`
                <tr>
                    <td><input type="text"id="roomId0"value="${roomI}"disabled/></td>
                    <td><select id="deviceType0">
                        <option value="0">请选择</option>
                        <option value="ZIGBEE_Light">灯</option>
                        <option value="ZIGBEE_InfraredTransponder">红外遥控</option>
                        <option value="ZIGBEE_CurtainMotor">窗帘电机</option>
                        <option value="ZIGBEE_KonkeSocket">智能插座</option>
                        <option value="ZIGBEE_InfraredSensor">人体红外</option>
                        <option value="ZIGBEE_SmokeSensor">烟感</option>
                        <option value="ZIGBEE_DipSensor">水浸</option>
                        <option value="ZIGBEE_DoorSensor">门禁</option>
                        <option value="ZIGBEE_TempSensor">温度传感</option>
                        <option value="ZIGBEE_HumiSensor">湿度传感</option>
                    </select></td>
                    <td><select id="selP0">
                    </select></td><td>
                    <select id="OOC0" style="width:200px">
                        <option value="OFF">OFF</option>
                        <option value="ON">ON</option>
                    </select>
                 </td>
                <td><input type='text'  id="delay0"value=""></td>
                </tr>
        `;
        $('#example4').on('change','#deviceType0',function() {
                    var html5='';
                    for (var i = 0; i < tempD.length; i++) {
                        (function (i) {
                            if (tempD[i].deviceType == $('#deviceType0').val()) {
                                html5 += `
                    <option value="${tempD[i].id}">${tempD[i].name}</option>
                    `
                            }
                        })(i)
                    }
                    $('#selP0').html(html5)
                }
        )
        $('#example4 tbody').empty().html(html4);

    })
    function revT(n){
        $('#example3').unbind();
        var strN=tempHost.hostDataRepository.getEXIFTTTInfoById(n);
        tempD=showAllDevices();
        var html1=` <td><input type="text" id="IFTTTId" value=${n}></td>
                      <td><input type="text" id="IFTTTRoom"value="${roomI}"disabled></td>
                      <td><input type="text" id="IFTTTName"value="${strN.name}"></td>
                      <td>
                        <select id="IFTTTNoteEnable">
                          <option value="true">启用</option>
                          <option value="false">禁用</option>
                        </select>
                      </td>
                      <td>
                        <select id="IFTTTEnable">
                          <option value="true">启用</option>
                          <option value="false">禁用</option>
                        </select>
                      </td>
                    <td>

                    </td>
                </tr>`;

        $('#example2 tbody').empty().html(html1);
        var html2=`
        <tr>
            <td><input type="text"id="roomIdI0"value="${roomI}"disabled/></td>
            <td><select name="deviceType"id="deviceTypeI0">
                <option value="0">请选择</option>
                <option value="ZIGBEE_Light">灯</option>
                <option value="ZIGBEE_InfraredTransponder">红外遥控</option>
                <option value="ZIGBEE_CurtainMotor">窗帘电机</option>
                <option value="ZIGBEE_KonkeSocket">智能插座</option>
                <option value="ZIGBEE_InfraredSensor">人体红外</option>
                <option value="ZIGBEE_SmokeSensor">烟感</option>
                <option value="ZIGBEE_DipSensor">水浸</option>
                <option value="ZIGBEE_DoorSensor">门禁</option>
                <option value="ZIGBEE_TempSensor">温度传感</option>
                <option value="ZIGBEE_HumiSensor">湿度传感</option>
            </select></td>
            <td><select name="id"id="selI0">
                    </select></td>
            <td><select name="compareType"id="compareTypeI0">
                <option value="0">请选择</option>
            </select></td>
            <td><input type="text"id="xiaoyu0"/></td>
            <td></td>
        </tr>` ;
        $('#example3').on('change','#deviceTypeI0',function() {
                    var html3='';
                    for (var i = 0; i < tempD.length; i++) {
                        (function (i) {
                            if (tempD[i].deviceType == $('#deviceTypeI0').val()) {
                                html3 += `
                                <option value="${tempD[i].id}">${tempD[i].name}</option>
                                `
                            }
                        })(i)
                    }
                    $('#selI0').html(html3);
                    var htmle1='';
                    var htmle2='';
                    switch ($(this).val()) {
                        case 'ZIGBEE_Light':
                            htmle1+=`
                                <option value="ON">开</option>
                                <option value="OFF">关</option>
                            `
                            htmle2=true;
                            break;
                        case 'ZIGBEE_KonkeSocket':
                            htmle1+=`
                                <option value="ON">开</option>
                                <option value="OFF">关</option>
                            `
                            htmle2=true;
                            break;
                        case 'ZIGBEE_InfraredSensor':
                            htmle1+=`
                                <option value="1">报警</option>
                            `
                            htmle2=true;
                            break;
                        case 'ZIGBEE_SmokeSensor':
                            htmle1+=`
                                <option value="1">报警</option>
                            `
                            htmle2=true;
                            break;
                        case 'ZIGBEE_DipSensor':
                            htmle1+=`
                                <option value="1">报警</option>
                            `
                            htmle2=true;
                            break;
                        case 'ZIGBEE_DoorSensor':
                            htmle1+=`
                                <option value="OPEN">开</option>
                                <option value="CLOSE">关</option>
                            `
                            htmle2=true;
                            break;
                        case 'ZIGBEE_TempSensor':
                            htmle1+=`
                                <option value="1">相等</option>
                                <option value="2">小于</option>
                                <option value="3">大于</option>
                            `
                            break;
                        case 'ZIGBEE_HumiSensor':
                            htmle1+=`
                                <option value="1">相等</option>
                                <option value="2">小于</option>
                                <option value="3">大于</option>
                            `
                            break;
                    }
                    if(htmle1!=''){
                        $('#compareTypeI0').html(htmle1);
                    }
                    if(htmle2==true){
                        $('#xiaoyu0').attr('type','hidden');
                    }else{
                        $('#xiaoyu0').attr('type','text');
                    }
                }
        )
        $('#example3 tbody').empty().html(html2);
        var html4=`
                <tr>
                    <td><input type="text"id="roomId0"value="${roomI}"disabled/></td>
                    <td><select id="deviceType0">
                        <option value="0">请选择</option>
                        <option value="ZIGBEE_Light">灯</option>
                        <option value="ZIGBEE_InfraredTransponder">红外遥控</option>
                        <option value="ZIGBEE_CurtainMotor">窗帘电机</option>
                        <option value="ZIGBEE_KonkeSocket">智能插座</option>
                        <option value="ZIGBEE_InfraredSensor">人体红外</option>
                        <option value="ZIGBEE_SmokeSensor">烟感</option>
                        <option value="ZIGBEE_DipSensor">水浸</option>
                        <option value="ZIGBEE_DoorSensor">门禁</option>
                        <option value="ZIGBEE_TempSensor">温度传感</option>
                        <option value="ZIGBEE_HumiSensor">湿度传感</option>
                    </select></td>
                    <td><select id="selP0">
                    </select></td><td>
                    <select id="OOC0" style="width:200px">
                        <option value="OFF">OFF</option>
                        <option value="ON">ON</option>
                    </select>
                 </td>
                <td><input type='text'  id="delay0"value=""></td>
                </tr>
        `;
        $('#example4').on('change','#deviceType0',function() {
                    var html5='';
                    for (var i = 0; i < tempD.length; i++) {
                        (function (i) {
                            if (tempD[i].deviceType == $('#deviceType0').val()) {
                                html5 += `
                    <option value="${tempD[i].id}">${tempD[i].name}</option>
                    `
                            }
                        })(i)
                    }
                    $('#selP0').html(html5)
                }
        )
        $('#example4 tbody').empty().html(html4);

    }
    $('#save0').click(function(){
        var arrA=[];
        for(var i=0;i<$('#example4 tr').length-1;i++){
            (function(i) {
                var roomId = '#roomId' + i;
                var deviceType = '#deviceType' + i;
                var deviceName = '#deviceName' + i;
                var OOC = '#OOC' + i;
                var delay = '#delay' + i;
                var selP='#selP'+i;
                if($(deviceType).val()=="ZIGBEE_InfraredTransponder"){
                    OOC="空调打开"
                }else{
                    OOC=$(OOC).val()
                }
                arrA.push({
                    "deviceType": $(deviceType).val(),
                    "area": "11",
                    "name": $(selP).find("option:selected").text(),
                    "id": $(selP).val(),
                    "roomId": $(roomId).val(),
                    "operation":OOC,
                    "delay": $(delay).val()
                })
            })(i)
        }
        var arrB=[];
        for(var i=0;i<$('#example3 tr').length-1;i++){
            (function(i) {
                var roomId = '#roomIdI' + i;
                var deviceType = '#deviceTypeI' + i;
                var compareType = '#compareTypeI' + i;
                var xiaoyu='#xiaoyu'+i;
                var selI='#selI'+i;
                arrB.push({
                    "deviceType": $(deviceType).val(),
                    "area": "11",
                    "name": $(selI).find("option:selected").text(),
                    "id": $(selI).val(),
                    "roomId": $(roomId).val(),
                    "compareType": ($(compareType).find("option:selected").text()!='大于'&&$(compareType).find("option:selected").text()!='小于')?'相等':$(compareType).find("option:selected").text(),
                    "deivceIcon": '',
                    "leftValue": '*',
                    "rightValue": ($(compareType).find("option:selected").text()!='大于'&&$(compareType).find("option:selected").text()!='小于')?$(compareType).find("option:selected").val():$(xiaoyu).val()

                })
            })(i)
        }
        console.error(arrA);
        console.error(arrB);
        IFTTTName = $("#IFTTTName").val();
        IFTTTRoomId = $("#IFTTTRoom").val();
        IFTTTNote = ($("#IFTTTNoteEnable").val() == "true") ? true : false;
        IFTTTEnable = ($("#IFTTTEnable").val() == "true") ? true : false;
        tempHost.asyncAddEXIFTTT(IFTTTName, IFTTTRoomId, IFTTTNote, IFTTTEnable,arrB,[], arrA);


    })
    $('#save1').click(function(){
        var arrA=[];
        for(var i=0;i<$('#example4 tr').length-1;i++){
            (function(i) {
                var roomId = '#roomId' + i;
                var deviceType = '#deviceType' + i;
                var deviceName = '#deviceName' + i;
                var OOC = '#OOC' + i;
                var delay = '#delay' + i;
                var selP='#selP'+i
                arrA.push({
                    "deviceType": $(deviceType).val(),
                    "area": "11",
                    "name": $(selP).find("option:selected").text(),
                    "id": $(selP).val(),
                    "roomId": $(roomId).val(),
                    "operation": $(OOC).val(),
                    "delay": $(delay).val()
                })
            })(i)
        }
        var arrB=[];
        for(var i=0;i<$('#example3 tr').length-1;i++){
            (function(i) {
                var roomId = '#roomIdI' + i;
                var deviceType = '#deviceTypeI' + i;
                var compareType = '#compareTypeI' + i;
                var xiaoyu='#xiaoyu'+i;
                var selI='#selI'+i
                arrB.push({
                        "deviceType": $(deviceType).val(),
                        "area": "11",
                        "name": $(selI).find("option:selected").text(),
                        "id": $(selI).val(),
                        "roomId": $(roomId).val(),
                        "compareType": ($(compareType).find("option:selected").text()!='大于'&&$(compareType).find("option:selected").text()!='小于')?'相等':$(compareType).find("option:selected").text(),
                        "deivceIcon": '',
                        "leftValue": '*',
                        "rightValue": ($(compareType).find("option:selected").text()!='大于'&&$(compareType).find("option:selected").text()!='小于')?$(compareType).find("option:selected").val():$(xiaoyu).val()

                })
            })(i)
        }
        console.error(arrA);
        console.error(arrB);
        IFTTTId = $("#IFTTTId").val();
        IFTTTName = $("#IFTTTName").val();
        IFTTTRoomId = $("#IFTTTRoom").val();
        IFTTTNote = ($("#IFTTTNoteEnable").val() == "true") ? true : false;
        IFTTTEnable = ($("#IFTTTEnable").val() == "true") ? true : false;
        tempHost.asyncUpdateEXIFTTT(IFTTTId,IFTTTName, IFTTTRoomId, IFTTTNote, IFTTTEnable,arrB, [],arrA);


    })
    $('#addL1').click(function(){
        tempD=showAllDevices();
        var n=$('#example3 tr').length-1;
        var html2=`
        <tr>
            <td><input type="text"id="roomIdI${n}"value="${roomI}"disabled/></td>
            <td><select name="deviceType"id="deviceTypeI${n}">
                <option value="0">请选择</option>
                <option value="ZIGBEE_Light">灯</option>
                <option value="ZIGBEE_InfraredTransponder">红外遥控</option>
                <option value="ZIGBEE_CurtainMotor">窗帘电机</option>
                <option value="ZIGBEE_KonkeSocket">智能插座</option>
                <option value="ZIGBEE_InfraredSensor">人体红外</option>
                <option value="ZIGBEE_SmokeSensor">烟感</option>
                <option value="ZIGBEE_DipSensor">水浸</option>
                <option value="ZIGBEE_DoorSensor">门禁</option>
                <option value="ZIGBEE_TempSensor">温度传感</option>
                <option value="ZIGBEE_HumiSensor">湿度传感</option>
            </select></td>
            <td><select name="id"id="selI${n}">
                    </select></td>
            <td><select name="compareType"id="compareTypeI${n}">
                <option value="0">请选择</option>
            </select></td>
            <td><input type="text"id="xiaoyu${n}"/></td>
            <td></td>
        </tr>` ;
        var deviceType='#deviceTypeI'+n;
        var selI='#selI'+n;
        $('#example3').on('change',deviceType,function() {
                    var html3='';
                    for (var i = 0; i < tempD.length; i++) {
                        (function (i) {
                            if (tempD[i].deviceType == $(deviceType).val()) {
                                html3 += `
                                <option value="${tempD[i].id}">${tempD[i].name}</option>
                                `
                            }
                        })(i)
                    }
                    $(selI).html(html3)
                }
        )
        $('#example3 tbody').append(html2);
    })
    $('#addL2').click(function(){
        tempD=showAllDevices();
        var n=$('#example4 tr').length-1;
        var html4=`
                <tr>
                    <td><input type="text"id="roomId${n}"value="${roomI}"disabled/></td>
                    <td><select id="deviceType${n}">
                        <option value="0">请选择</option>
                        <option value="ZIGBEE_Light">灯</option>
                        <option value="ZIGBEE_InfraredTransponder">红外遥控</option>
                        <option value="ZIGBEE_CurtainMotor">窗帘电机</option>
                        <option value="ZIGBEE_KonkeSocket">智能插座</option>
                        <option value="ZIGBEE_InfraredSensor">人体红外</option>
                        <option value="ZIGBEE_SmokeSensor">烟感</option>
                        <option value="ZIGBEE_DipSensor">水浸</option>
                        <option value="ZIGBEE_DoorSensor">门禁</option>
                        <option value="ZIGBEE_TempSensor">温度传感</option>
                        <option value="ZIGBEE_HumiSensor">湿度传感</option>
                    </select></td>
                    <td><select id="selP${n}">
                    </select></td><td>
                    <select id="OOC0" style="width:200px">
                        <option value="OFF">OFF</option>
                        <option value="ON">ON</option>
                    </select>
                 </td>
                <td><input type='text'  id="delay0"value=""></td>
                </tr>
        `;
        var deviceType='#deviceType'+n;
        var selP='#selP'+n;
        $('#example4').on('change',deviceType,function() {
                    var html5='';
                    for (var i = 0; i < tempD.length; i++) {
                        (function (i) {
                            if (tempD[i].deviceType == $(deviceType).val()) {
                                html5 += `
                    <option value="${tempD[i].id}">${tempD[i].name}</option>
                    `
                            }
                        })(i)
                    }
                    $(selP).html(html5)
                }
        )
        $('#example4 tbody').append(html4);
    })
    tip_list=[
        '点击操作列<span>‘查看’</span>查看该行主机下已存在的IFTTT模式',
        '点击<span>‘添加’</span>按钮可添加IFTTT，三张表全部填入信息才能点击<span>‘保存’</span>进行添加，在操作列点击<span>‘编辑’</span>进行编辑后点击 <span>‘保存修改’</span>进行保存',
        '点击 <span>‘添加一行’</span>添加触发条件,只能编辑主机下一存在的设备',
        '点击 <span>‘添加一行’</span>添加IFTTT模式下的设备及状态'
    ];
    var i=0;
    $('body').find('.operate-tip').each(function () {
        $(this).attr('data-step',i);
        $(this).find('b').html(tip_list[i]);
        if(i>0){
            $(this).hide();
        }
        i++;
    });
    //    $('body').find("[data-step='0']").show();
//    $('body').find('.operate-tip').on('mouseover','i', function () {
//        $(this).parent().find('b').show();
//    })
//    $('body').find('.operate-tip').on('mouseout','i', function () {
//        $(this).parent().find('b').hide();
//    })
</script>
</body>
</html>

