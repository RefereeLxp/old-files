<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>AdminLTE 2 | Dashboard</title>
    <!-- Tell the browser to be responsive to screen width -->
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <!-- Bootstrap 3.3.6 -->
    <link rel="stylesheet" href="../../../css/bootstrap.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="../../../css/font-awesome.css">
    <!-- Theme style -->
    <link rel="stylesheet" href="../../../css/AdminLTE.css">
    <!-- AdminLTE Skins. Choose a skin from the css/skins
         folder instead of downloading all of them to reduce the load. -->
    <link rel="stylesheet" href="../../../css/skins/_all-skins.min.css">
    <!-- iCheck -->
    <link rel="stylesheet" href="../../../js/plugins/iCheck/flat/blue.css">
    <!-- jvectormap -->
    <link rel="stylesheet" href="../../../js/plugins/jvectormap/jquery-jvectormap-1.2.2.css">
    <!-- Date Picker -->
    <link rel="stylesheet" href="../../../js/plugins/datepicker/datepicker3.css">
    <!-- Daterange picker -->
    <link rel="stylesheet" href="../../../js/plugins/daterangepicker/daterangepicker.css">
    <!-- bootstrap wysihtml5 - text editor -->
    <link rel="stylesheet" href="../../../js/plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.min.css">
    <link rel="stylesheet" href="../../../js/plugins/datatables/dataTables.bootstrap.css">
    <link rel="stylesheet" href="../../../css/new.css"/>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<body class="hold-transition skin-blue sidebar-mini">
<div class="wrapper">

    <header class="main-header">
        <a href="../../home/main/index.html" class="logo" style="padding-left: 0;padding-right: 0;">
          <span class="logo-mini">
          <img src="../../../image/logo.jpg" style="width: 20px;height: 36px;" alt=""/>
          </span>
          <span class="logo-lg" style="text-align: left;background: #333333;padding-left: 10px;">
            <img src="../../../image/logo.jpg" style="width: 20px;height: 36px;" alt=""/>
            <b style="font-size: 16px;">管理控制台</b>
          </span>
        </a>
        <nav class="navbar navbar-static-top" style="background: #333333;box-shadow:0px 5px 0 #FEC97D">
            <!-- Sidebar toggle button-->
            <a href="#" class="sidebar-toggle" data-toggle="offcanvas" role="button">
                <span class="sr-only">Toggle navigation</span>
            </a>
            <div class="navbar-custom-menu">
                <ul class="nav navbar-nav choose">
                    <li class="dropdown user user-menu" id="userName">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
                            <img src="../../../image/111.jpg" class="user-image" alt="User Image">
                            <span class="hidden-xs">${name}</span>
                        </a>
                        <ul class="dropdown-menu">
                            <li class="user-header">
                                <img src="../../../image/111.jpg" class="img-circle" alt="User Image">

                                <p>
                                    tom-超级管理员
                                    <small>成员 since Nov. 2012</small>
                                </p>
                            </li>
                            <li class="user-footer">
                                <div class="pull-left">
                                    <a href="#" class="btn btn-default btn-flat">Profile</a>
                                </div>
                                <div class="pull-right">
                                    <a href="#" class="btn btn-default btn-flat"onclick="logout()">登出</a>
                                </div>
                            </li>
                        </ul>
                    </li>

                </ul>
            </div>
        </nav>
    </header>
    <aside class="main-sidebar">
        <section class="sidebar" id="sidebar">
            <div style="height: 60px;"></div>
            <ul class="sidebar-menu">
                <!--<li class="treeview ztjc">-->
                    <!--<a href="#">-->
                        <!--<i class="fa"></i> <span>状态监测</span>-->
                    <!--</a>-->
                    <!--<ul class="treeview-menu">-->
                        <!--<li><a href="../../home/main/index.html"><i class="fa fa-circle"></i> 实时数据 <i class="fa  fa-caret-right"></i></a></li>-->
                    <!--</ul>-->
                <!--</li>-->
                <!--<li class="treeview rysz">-->
                    <!--<a href="#">-->
                        <!--<i class="fa "></i>-->
                        <!--<span>人员设置</span>-->
                    <!--</a>-->
                    <!--<ul class="treeview-menu">-->
                        <!--<li><a href="../../prv/role/index.html"><i class="fa fa-circle"></i> 角色设置 <i class="fa  fa-caret-right"></i></a></li>-->
                        <!--<li><a href="../../prv/member/index.html"><i class="fa fa-circle"></i> 操作员设置 <i class="fa  fa-caret-right"></i></a></li>-->
                        <!--<li><a href="../../prv/manage/index.html"><i class="fa fa-circle"></i> 日志查询 <i class="fa  fa-caret-right"></i></a></li>-->
                    <!--</ul>-->
                <!--</li><li class="treeview zdsz">-->
                <!--<a href="#">-->
                    <!--<i class="fa "></i>-->
                    <!--<span>站点设置</span>-->
                <!--</a>-->
                <!--<ul class="treeview-menu">-->
                    <!--<li><a href="../../ass/psysical/index.html"><i class="fa fa-circle"></i> 物理设置 <i class="fa  fa-caret-right"></i></a></li>-->
                    <!--<li><a href="../../ass/gateway/index.html"><i class="fa fa-circle"></i> 网关设置 <i class="fa  fa-caret-right"></i></a></li>-->
                    <!--<li><a href="../../ass/alarm/index.html"><i class="fa fa-circle"></i> 监控告警 <i class="fa  fa-caret-right"></i></a></li>-->
                    <!--<li><a href="../../ass/history/index.html"><i class="fa fa-circle"></i> 数据采集 <i class="fa  fa-caret-right"></i></a></li>-->
                <!--</ul>-->
            <!--</li>-->
                <!--<li class="active treeview qjsz">-->
                    <!--<a href="#">-->
                    <!--<i class="fa "></i>-->
                    <!--<span>情景设置</span>-->
                    <!--</a>-->
                    <!--<ul class="treeview-menu">-->
                        <!--<li class="active"><a href="index.html"><i class="fa fa-circle"></i> 情景模式 <i class="fa  fa-caret-right"></i></a></li>-->
                        <!--<li class="active"><a href="../IFTTT6/index.html"><i class="fa fa-circle"></i> IFTTT <i class="fa  fa-caret-right"></i></a></li>-->
                        <!--<li class="active"><a href="../IFTTT/index.html"><i class="fa fa-circle"></i> IFTTT <i class="fa  fa-caret-right"></i></a></li>-->
                    <!--</ul>-->
                <!--</li>-->
                <!--<li class="treeview jcsz">-->
                    <!--<a href="#">-->
                        <!--<i class="fa "></i>-->
                        <!--<span>基础设置</span>-->
                    <!--</a>-->
                    <!--<ul class="treeview-menu">-->
                    <!--</ul>-->
                <!--</li>-->
                <!--<li class="treeview gywm">-->
                    <!--<a href="#">-->
                        <!--<i class="fa "></i>-->
                        <!--<span>关于我们</span>-->
                    <!--</a>-->
                    <!--<ul class="treeview-menu">-->
                        <!--<li><a href="../../about/index.html"><i class="fa fa-circle"></i> 简介 <i class="fa  fa-caret-right"></i></a></li>-->
                    <!--</ul>-->
                <!--</li>-->

            </ul>
        </section>
        <!-- /.sidebar -->
    </aside>
    <div class="content-wrapper">
        <div class="row">
            <div class="col-xs-12">
                <!-- Main content -->
                <section class="content">
                    <div class="box">
                        <div class="box-header with-border">
                            <h3 class="box-title">监控主机表</h3>
                        </div>
                        <!-- /.box-header -->
                        <div class="box-body">
                            <table id="example1" class="table table-bordered table-hover">
                                <thead>
                                <tr>
                                    <th>监控主机id</th>
                                    <th>监控主机编号</th>
                                    <th>监控主机名称</th>
                                    <th>监控主机key</th>
                                    <th>所属监控站</th>
                                    <th>IP地址</th>
                                    <th>操作</th>
                                </tr>
                                </thead>
                                <tbody>

                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="box">
                        <div class="box-header with-border">
                            <h3 class="box-title">情景模式表1</h3>
                            <div class="pull-right box-tools">
                                <button class="btn"data-toggle="modal" data-target="#maintenance" id="add0">添加0</button>
                            </div>
                        </div>
                        <div class="box-body">
                            <table id="example2" class="table table-bordered table-hover">
                                <thead>
                                <tr>
                                    <th>序号</th>
                                    <th>房间</th>
                                    <th>情景名称</th>
                                    <th>情景选择</th>
                                    <th>操作</th>
                                </tr>
                                </thead>
                                <tbody>

                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="box">
                        <div class="box-header with-border">
                            <h3 class="box-title">情景模式表2</h3>
                        </div>
                        <div class="box-body">
                            <table id="example3" class="table table-bordered table-hover">
                                <thead>
                                <tr>
                                    <th>模式ID</th>
                                    <th>启用天</th>
                                    <th>启用时</th>
                                    <th>是否启用</th>
                                    <th>操作</th>
                                </tr>
                                </thead>
                                <tbody>

                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="box">
                        <div class="box-header with-border">
                            <h3 class="box-title">情景模式表3</h3>
                            <div class="pull-right box-tools">
                                <button class="btn" id="add-action">编辑</button>
                                <button class="btn" id="add-line"style="display:none">添加一行</button>
                                <button class="btn" id="save-action"style="display:none">保存</button>
                            </div>
                        </div>
                        <div class="box-body">
                            <table id="example4" class="table table-bordered table-hover">
                                <thead>
                                <tr>
                                    <th style="width: 10%">房间ID</th>
                                    <th style="width: 18%">设备类型</th>
                                    <th style="width: 18%">设备名称</th>
                                    <th style="width: 18%">状态(开/关)</th>
                                    <th style="width: 18%">延时值</th>
                                </tr>
                                </thead>
                                <tbody>

                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>
            </div>
        </div>

        <div class="modal fade" id="maintenance" tabindex="-1" role="dialog" aria-labelledby="ModalLabel1" aria-hidden="true" data-backdrop="static">
            <div class="modal-dialog" style="width:560px;margin-top: 220px">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                            ×
                        </button>
                        <h4 class="modal-title" >
                            情景设置
                        </h4>
                    </div>
                    <div class="modal-body" id="flex">
                    </div>
                </div>
                <!-- /.modal-content -->
            </div>
            <!-- /.modal -->
        </div>
    </div>
</div>
<!-- jQuery 2.2.3 -->
<script src="../../../js/plugins/jQuery/jquery-2.2.3.min.js"></script>
<!-- jQuery UI 1.11.4 -->
<script src="../../../js/plugins/jQueryUI/jquery-ui.min.js"></script>
<!-- Resolve conflict in jQuery UI tooltip with Bootstrap tooltip -->
<script>
    $.widget.bridge('uibutton', $.ui.button);
</script>
<!-- Bootstrap 3.3.6 -->
<script src="../../../js/menu.js"></script>
<script src="../../../js/bootstrap.min.js"></script>
<script src="../../../js/plugins/datatables/jquery.dataTables.min.js"></script>
<script src="../../../js/plugins/datatables/dataTables.bootstrap.min.js"></script>
<script src="../../../js/normal.js"></script>
<!-- Sparkline -->
<script src="../../../js/plugins/sparkline/jquery.sparkline.min.js"></script>
<!-- jvectormap -->
<script src="../../../js/plugins/jvectormap/jquery-jvectormap-1.2.2.min.js"></script>
<script src="../../../js/plugins/jvectormap/jquery-jvectormap-world-mill-en.js"></script>
<script src="../../../js/plugins/chartjs/Chart.js"></script>
<!-- jQuery Knob Chart -->
<script src="../../../js/plugins/knob/jquery.knob.js"></script>
<!-- daterangepicker -->
<script src="../../../js/moment.js"></script>
<script src="../../../js/plugins/daterangepicker/daterangepicker.js"></script>
<!-- datepicker -->
<script src="../../../js/plugins/datepicker/bootstrap-datepicker.js"></script>
<!-- Bootstrap WYSIHTML5 -->
<script src="../../../js/plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.all.min.js"></script>
<!-- Slimscroll -->
<script src="../../../js/plugins/slimScroll/jquery.slimscroll.min.js"></script>
<!-- FastClick -->
<script src="../../../js/plugins/fastclick/fastclick.js"></script>
<!-- AdminLTE App -->
<script src="../../../js/app.min.js"></script>
<!-- AdminLTE dashboard demo (This is only for demo purposes) -->
<script src="../../../js/pages/dashboard.js"></script>
<!-- AdminLTE for demo purposes -->
<script src="../../../js/demo.js"></script>
<script src="../../../js/sdk/SH_SDK_v1.1.2.js"></script>
<script type="text/javascript" src="../../../js/sdk/gateway.js"></script>
<script type="text/javascript" src="../../../js/sdk/displayInformation.js"></script>
<script type="text/javascript" src="../../../js/sdk/config.js"></script>
<script type="text/javascript" src="../../../js/sdk/operate.js"></script>
<script type="text/javascript" src="../../../js/sdk/scene.js"></script>
<script type="text/javascript" src="../../../js/sdk/IFTTT.js"></script>
<script>

    //----------------------------------------------------------------------------------------------------------------------
    var kHost = null;
    var tempHost = null;
    var str=null;
    var refresh=null;
    var tempnn=0;
    $('#example1').on('click','.stations-check',function(){
        var host_code=$(this).parent().parent().find('td').eq(1).html();
        var host_key=$(this).parent().parent().find('td').eq(3).html();
        console.log(host_code,host_key);
        sessionStorage.setItem('host_code',host_code);
        sessionStorage.setItem('host_key',host_key);
        location.reload();
    });
    function connect() {
        var deviceId = sessionStorage['host_code'];
        var accessKey = sessionStorage['host_key'];

        kHost = new CKHost(deviceId, accessKey);
        kHost.registerHostStatusCallback(hostStatusCallBack);
        kHost.registerDeviceStatusCallback(deviceStatusCallBack);
        kHost.init();
        tempHost=kHost.mainHost;
    }
    if(sessionStorage['host_code']!=null) {
        connect();
    }


    function hostStatusCallBack(data) {
        //console.debug('hostStatusCallBack: [' + data + ']');
        $("#link").html(kHost.linkStatus ? '成功' : '');
        $("#login").html(kHost.loginStatus ? '成功' : '');
        $("#synch").html(kHost.synStatus ? '成功' : '');
        str=showScenes();
        if(str!=''&&str!=undefined){
            var html='';
            for(var i=0;i<str.length;i++){
                console.error(str[i]);
                html+=`
            <tr>
                <td>${str[i].id}</td>
                <td>${str[i].roomId}</td>
                <td>${str[i].name}</td>
                <td>${str[i].sceneType}</td>
                <td>
                <a href="#" onclick="showT(${i})">查看</a>
                <span>|</span>
                <a href="#" onclick="revT(${i})"data-toggle="modal" data-target="#maintenance" >修改</a>
                <span>|</span>
                <a href="#"onclick=deleteT("${str[i].id}")>删除</a>
                </td>
                </tr>
                `;
                $.ajax({
                    url:'http://202.119.65.27:9999/monitor/scene/scene/create',
                    type:'POST',
                    data: {"id":str[i].id,"name":str[i].name,"roomId":str[i].roomId,"sceneType":str[i].sceneType,"timerEnable":str[i].timerEnable,"timerTime":str[i].timerTime.toString(),"timerWeeks":JSON.stringify(str[i].timerWeeks),"actions":JSON.stringify(str[i].actions)},
                    success:function(){
                        alert('成功')
                    }
                })
            }
            $('#example2 tbody').empty().html(html);
            refresh=$("#example2").DataTable();

        }

    }
    function showT(n){
        str=showScenes();
        tempnn=n;
        console.error(str[n])
        var htmlw=str[n].timerWeeks.join(',');
        if(str[n].timerEnable==true){
            var a='是'
        }else if(str[n].timerEnable==false){
            var a='否'
        }
        var html=`
    <tr>
        <td>${str[n].id}</td>
        <td>${htmlw}</td>
        <td>${str[n].timerTime}</td>
        <td>${a}</td>
        <td><a href="#"data-toggle="modal" data-target="#maintenance" onclick="revTime(${str[n].id})">编辑</a></td>
        </tr>
        `
        $('#example3 tbody').empty().html(html);
        var html2=''
        for(var i=0;i<str[n].actions.length;i++){
            html2+=`
        <tr>
            <td>${str[n].actions[i].roomId}</td>
            <td>${str[n].actions[i].deviceType}</td>
            <td>${str[n].actions[i].name}</td>
            <td>${str[n].actions[i].operation}</td>
            <td>${str[n].actions[i].delay}</td>
            </tr>
            `
        }
        $('#example4 tbody').empty().html(html2);
    }
    function deviceStatusCallBack(jData) {
        console.debug('deviceStatusCallBack: id[' + jData.id + '] name[' + jData.name + ']');
        console.debug(jData);
        str=showScenes();
    }

    function getFloor() {
        var jdata = kHost.getFloor();
        console.debug('getFloor num[' + jdata.length + ']');
        for(var i in jdata){
            console.debug('getFloor [' + i + '] id[' + jdata[i].id + '] name[' + jdata[i].name + ']');
        }
        console.debug(jdata);
        postFloor(jdata);
    }

    function getRoom() {
        var jdata = kHost.getRoom();
        console.debug('getRoom num[' + jdata.length + ']');
        for(var i in jdata){
            console.debug('getRoom [' + i + '] id[' + jdata[i].id + '] name[' + jdata[i].name + '] floorid[' + jdata[i].floorId + ']');
        }
        postRoom(jdata);
    }

    function checkHostObject() {
        if (tempHost== null) {
            return false;
        }
        return true;
    }
    //查看相应主机下的设备
    $("#maintenance").on('hidden.bs.modal',function(){
        alert(1);
    });
    $('#add0').click(function(){
        $('#flex').html(
                `
        <div class="pop-main">
        <div class="monitor-station">
        <p class="main-title">新增项目</p>

        <div class="head-box">
        <form id="hostADD">

        <div class="row">
            <div class="col-xs-12 input-line">
                <span>情景名称</span>
                <div class="input-box">
                     <input type="text"id="sceneName" data-type='1'>
                </div>
                <b></b>
            </div>
            <div class="col-xs-12 input-line">
                <span>应用房间</span>
                <div class="input-box">
                    <input type="text"id="sceneRoomId" data-type='2'>
                </div>
                <b></b>
            </div>
            <div class="col-xs-12 input-line">
                <span>情景选择</span>
                <div class="input-box">
                     <input type="text"id="sceneType" data-type='3'>
                </div>
                <b></b>
            </div>
        </div>
        <div class="row"><div class="col-xs-4"></div><div class="col-xs-4"></div><div class="col-xs-4"><botton type="button" class="btn my-btn"id="insH">保存</botton></div></div>
        </form>
        </div>
        </div>
        </div>
                `
        )
    })
    var tempD="";
    function revTime(n){
        $('#flex').html(
                `
    <div class="pop-main">
        <div class="monitor-station">
        <p class="main-title">修改时间</p>

        <div class="head-box">
        <form id="hostADD">

        <div class="row">
        <input type="hidden"id="sceneId"value=${n}>
    <div class="col-xs-12"><span>启用天</span><input type="text"id="sceneWeek"></div>
        <div class="col-xs-12"><span>启用时</span><input type="text"id="sceneTime"></div>
        <div class="col-xs-12"><span>是否启用</span><select id="sceneEnable" style="width:200px">
        <option value="true">启用</option>
        <option value="false">禁用</option>
        </select></div>
        </div>
        <div class="row"><div class="col-xs-4"></div><div class="col-xs-4"></div><div class="col-xs-4"><botton type="button" class="btn my-btn"id="timeS">保存</botton></div></div>
        </form>
        </div>
        </div>
        </div>

                `
    )
    }
    $('#add-line').click(function(){
        var tr;
        var nn=$('#example4 tr').length-1;
        tr=`
        <tr>
        <td id="roomId${nn}">${str[tempnn].roomId}</td>
        <td><select id="deviceType${nn}">
        <option value="ZIGBEE_Light">ZIGBEE_Light</option>
        <option value="ZIGBEE_InfraredTransponder">ZIGBEE_InfraredTransponder</option>
        <option value="ZIGBEE_CurtainMotor">ZIGBEE_CurtainMotor</option>
        <option value="ZIGBEE_KonkeSocket">ZIGBEE_KonkeSocket</option>
        <option value="ZIGBEE_InfraredSensor">ZIGBEE_InfraredSensor</option>
        <option value="ZIGBEE_SmokeSensor">ZIGBEE_SmokeSensor</option>
        <option value="ZIGBEE_DipSensor">ZIGBEE_DipSensor</option>
        <option value="ZIGBEE_DoorSensor">ZIGBEE_DoorSensor</option>
        <option value="ZIGBEE_TempSensor">ZIGBEE_TempSensor</option>
        <option value="ZIGBEE_HumiSensor">ZIGBEE_HumiSensor</option>
        <option value="ZIGBEE_InfraredTransponder">ZIGBEE_InfraredTransponder</option>
        </select>
        </td>
        <td><select id="deviceName${nn}">
        <option value=""></option>
        </select>
        </td>
        <td>
        <select id="OOC${nn}" style="width:200px">
        <option value="OFF">OFF</option>
        <option value="ON">ON</option>
        </select>
        </td>
        <td><input type='text'  id="delay${nn}"value=""></td>
        </tr>
        `
        $('#example4 tbody').append(tr);
        for(var i=0;i<$('#example4 tr').length;i++) {
            (function(i) {
                var roomId = '#roomId' + i;
                var deviceType = '#deviceType' + i;
                var deviceName = '#deviceName' + i;
                var OOC = '#OOC' + i;
                var delay = '#delay' + i;
                $('#example4').on('change', deviceType, function () {
                    console.error(deviceType)
                    var html3 = '';
                    for (var i = 0; i < tempD.length; i++) {
                        (function (i) {
                            if (tempD[i].deviceType == $(deviceType).val()) {
                                html3 += `
                            <option value="${tempD[i].id}">${tempD[i].name}</option>
                    `
                            }
                        })(i)
                    }
                    $(deviceName).html(html3);
                    $(OOC).html(`
                    <option value="OFF">OFF</option>
                    <option value="ON">ON</option>
           `)
                    $(delay).html(`
                    <input type='text' id=delay>
            `)
                })
            })(i)
        }
        $("#save-action").unbind("click");
        $('#save-action').click(function(){
            $(this).css('display','none');
            $('#add-line').css('display','none');
            $('#add-action').css('display','inline-block');
            var arrA=[];
            for(var i=0;i<$('#example4 tr').length-1;i++){
                (function(i) {
                    var roomId = '#roomId' + i;
                    var deviceType = '#deviceType' + i;
                    var deviceName = '#deviceName' + i;
                    var OOC = '#OOC' + i;
                    var delay = '#delay' + i;
                    arrA.push({
                        "id": $(deviceName).val(),
                        "area": "11",
                        "name": $(deviceName).find("option:selected").text(),
                        "roomId": $(roomId).text(),
                        "operation": $(OOC).val(),
                        "deviceType": $(deviceType).val(),
                        "delay": $(delay).val()
                    })
                })(i)
            }
            console.error(arrA);
            tempHost.asyncSetSceneAction(str[tempnn].id, arrA);
        })
    })
    $('#add-action').click(function(){
        $(this).css('display','none');
        $('#save-action').css('display','inline-block');
        $('#add-line').css('display','inline-block');
        tempD=showAllDevices();
        var html2='' ;
        console.error(tempD);
        for(var i=0;i<str[tempnn].actions.length;i++){
            html2+=`
        <tr>
            <td id="roomId${i}">${str[tempnn].actions[i].roomId}</td>
            <td><select id="deviceType${i}">
            <option value="${str[tempnn].actions[i].deviceType}">${str[tempnn].actions[i].deviceType}</option>
            <option value="ZIGBEE_Light">ZIGBEE_Light</option>
            <option value="ZIGBEE_InfraredTransponder">ZIGBEE_InfraredTransponder</option>
            <option value="ZIGBEE_CurtainMotor">ZIGBEE_CurtainMotor</option>
            <option value="ZIGBEE_KonkeSocket">ZIGBEE_KonkeSocket</option>
            <option value="ZIGBEE_InfraredSensor">ZIGBEE_InfraredSensor</option>
            <option value="ZIGBEE_SmokeSensor">ZIGBEE_SmokeSensor</option>
            <option value="ZIGBEE_DipSensor">ZIGBEE_DipSensor</option>
            <option value="ZIGBEE_DoorSensor">ZIGBEE_DoorSensor</option>
            <option value="ZIGBEE_TempSensor">ZIGBEE_TempSensor</option>
            <option value="ZIGBEE_HumiSensor">ZIGBEE_HumiSensor</option>
            <option value="ZIGBEE_InfraredTransponder">ZIGBEE_InfraredTransponder</option>
            </select>
            </td>
            <td><select id="deviceName${i}">
            <option value="${str[tempnn].actions[i].id}">${str[tempnn].actions[i].name}</option>
            </select>
            </td>
            <td>
            <select id="OOC${i}" style="width:200px">
            <option>${str[tempnn].actions[i].operation}</option>
            </select>
            </td>
            <td><input type='text'  id="delay${i}"value="${str[tempnn].actions[i].delay}"></td>
            </tr>
        `
        }
        $('#example4 tbody').empty().html(html2);
        for(var i=0;i<$('#example4 tr').length;i++) {
            (function(i) {
                var roomId = '#roomId' + i;
                var deviceType = '#deviceType' + i;
                var deviceName = '#deviceName' + i;
                var OOC = '#OOC' + i;
                var delay = '#delay' + i;
                $('#example4').on('change', deviceType, function () {
                    console.error(deviceType)
                    var html3 = '';
                    for (var i = 0; i < tempD.length; i++) {
                        (function (i) {
                            if (tempD[i].deviceType == $(deviceType).val()) {
                                html3 += `
                            <option value="${tempD[i].id}">${tempD[i].name}</option>
                    `
                            }
                        })(i)
                    }
                    $(deviceName).html(html3);
                    $(OOC).html(`
                    <option value="OFF">OFF</option>
                    <option value="ON">ON</option>
           `)
                    $(delay).html(`
                    <input type='text' id=delay>
            `)
                })
            })(i)
        }


    })
    $('#save-action').click(function(){
        $(this).css('display','none');
        $('#add-line').css('display','none');
        $('#add-action').css('display','block');
        var arrA=[];
        for(var i=0;i<$('#example4 tr').length-1;i++){
            (function(i) {
                var roomId = '#roomId' + i;
                var deviceType = '#deviceType' + i;
                var deviceName = '#deviceName' + i;
                var OOC = '#OOC' + i;
                var delay = '#delay' + i;
                if($(deviceType).val()=="ZIGBEE_InfraredTransponder"){
                    OOC="空调打开"
                }else{
                    OOC=$(OOC).val()
                }
                arrA.push({
                    "id": $(deviceName).val(),
                    "area": "11",
                    "name": $(deviceName).find("option:selected").text(),
                    "roomId": $(roomId).text(),
                    "operation": $(OOC).val(),
                    "deviceType": $(deviceType).val(),
                    "delay": $(delay).val()
                })
            })(i)
        }
        console.error(arrA);
        tempHost.asyncSetSceneAction(str[tempnn].id, arrA);
    })
    $('#maintenance').on('click','#insH',function(){
        addScene();
        refresh.destroy();
        setTimeout(function(){connect()},1000)

        $( '#maintenance' ).modal( 'hide' );

    })
    $('#maintenance').on('click','#revS',function(){
        editScene()
        refresh.destroy();
        setTimeout(function(){connect()},1000)

        $( '#maintenance' ).modal( 'hide' );

    })
    $('#maintenance').on('click','#timeS',function(){

        setSceneTime()

        setTimeout(function(){showT(tempnn)},1000)


        $( '#maintenance' ).modal( 'hide' );

    })
    function deleteT(n){
        tempHost.asyncDeleteScene(n);
        refresh.destroy();
        setTimeout(function(){connect()},1000)
    }
    function revT(n){
        $('#flex').html(
                `
    <div class="pop-main">
        <div class="monitor-station">
        <p class="main-title">修改项目</p>

        <div class="head-box">
        <form id="hostADD">

        <div class="row">
        <input type="hidden"id="sceneId"value="${str[n].id}">
        <div class="col-xs-12"><span>情景名称</span><input type="text"id="sceneName"></div>
        <div class="col-xs-12"><span>应用房间</span><input type="text"id="sceneRoomId"></div>
        <div class="col-xs-12"><span>情景选择</span><input type="text"id="sceneType"></div>
        </div>
        <div class="row"><div class="col-xs-4"></div><div class="col-xs-4"></div><div class="col-xs-4"><botton type="button" class="btn my-btn"id="revS">保存</botton></div></div>
        </form>
        </div>
        </div>
        </div>

                `
    )
    }

</script>
</body>
</html>

